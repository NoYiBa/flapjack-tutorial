

# ![Flapjack](https://raw.github.com/flpjck/flapjack/gh-pages/images/flapjack-2013-notext-transparent-50-50.png "Flapjack") flapjack-tutorial
=================

A tutorial on getting started with Flapjack http://flapjack.io/

## Overview

In this tutorial, you'll get flapjack running in a vm using Vagrant and VirtualBox. You'll learn how to:
- configure flapjack
- simulate a failure of a monitored service
- integrate flapjack with nagios or icinga so flapjack takes over alerting
- import contacts and entities
- configure notification rules, intervals, and summary thresholds

## Getting flapjack up and running with vagrant-flapjack

Follow the instructions in [vagrant-flapjack](https://github.com/flpjck/vagrant-flapjack)

[TODO: consider providing the steps in this document rather than linking]

### Verify:

Visit [localhost:3080](http://localhost:3080) from your host workstation and you should see the flapjack web UI.

## Get comfortable with the flapjack CLI

`flapjack --help`
`simulate-failed-check --help`
etc

[TODO: check all the binscripts are in the PATH of the vagrant user by default]

## Start up the fake SMTP server (mailcatcher)

`mailcatcher`

Open up [http://localhost:1025](http://localhost:1025) - this will update dynamically whenever it catches an email generated by flapjack.

[TODO: add mailcatcher to vagrant-flapjack if it is not already, and forward the port for it]

## Simulate a check failure

`simulate-failed-check ...`

### Verify:

Reload the flapjack web UI and you should now be able to see the status of the check you're simulating.

## Integrate flapjack with nagios

[Or icinga?]

## Create contacts Ada and Charles

`curl ...`

[TODO: include an example contacts json file in vagrant-flapjack as a starting point]

## Create entities foo-app-01 and foo-db-01 (.example.com)

We're going to assign both Ada and Charles to foo-app-01, and just Ada to foo-db-01.

`curl ...`

[TODO: include an example entities json file in vagrant-flapjack to a starting point]

## Add some notification rules

Charles wants to receive critical alerts by both SMS and email, and warnings by email only. Charles never wants to see an unknown alert.

`curl ...`

Test with:

`simulate-failed-check ...`

----

Charles looks after disk utilisation problems and he's not very good at it, so Ada wants to never receive warnings about disk utilisation checks, but she still wants to be notified when they go critical.

`curl ...`

Test with:

`simulate-failed-check ...`

### Your turn

Ada wants to receive critical and warning alerts by both SMS and email, and wants to receive unknown alerts by email only.

- Come up with the JSON import actions to achieve this.
- Create and run the `simulate-failed-check ...` commands to test you've set the contact data up correctly.

## Modify the notification intervals

Ada wants to be notified at most every 3 hours by email, and every 5 minutes by sms:


### Your turn

Charles wants to be notified at most every 30 minute by email, and every 10 minutes by sms.


## Modify summary thresholds

Ada wants to have email alerts rolled up when there's 5 or more alerting checks, and to have sms alerts rolled up no matter how many alerting checks she has.

### Your turn

Charles wants to have email alerts rolled up when there's 10 or more alerting checks, and to have sms alerts rolled up when there's 3 or more alerting checks.


# TODO:
- add instructions for using a alternative Vagrant providers, eg AWS, VMWare Fusion
- add a jabber daemon with MUC, eg ejabberd, and include steps to integrate and test

